version: '3.9'

services:
  # nginx:
  #   image: docker.io/library/nginx
  #   volumes:
  #     - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
  #   network_mode: "host"
  #   restart: always

  # rosblox-studio:
  #   image: ghcr.io/rosblox/studio:latest
  #   volumes:
  #     - ./studio/layout.json:/src/layout.json
  #   ports:
  #     - 8080:8080
  #   restart: always

#  ros-rosbridge-suite:
#    image: ghcr.io/rosblox/ros-rosbridge-suite:humble
#    ports:
#      - 9090:9090
#    restart: always
#    command: ros2 launch rosbridge_server rosbridge_websocket_launch.xml

  ros-ina220:
    image: ghcr.io/rosblox/ros-ina220:humble
    devices:
      - "/dev/i2c-4:/dev/i2c-1"
    restart: always
    network_mode: "host"
    command: ros2 run ros_ina220 ros_ina220_publisher

  ros-cpu-temperature:
    image: ghcr.io/rosblox/ros-cpu-temperature:humble
    restart: always
    network_mode: "host"
    command: ros2 run ros_cpu_temperature ros_cpu_temperature_publisher

  ros-pca9685-ros2-control:
    image: ghcr.io/rosblox/ros-pca9685-ros2-control:humble
    devices:
      - "/dev/i2c-1:/dev/i2c-1"
    volumes:
      - ./pca9685_ros2_control/mixed_controller.yaml:/colcon_ws/src/pca9685_ros2_control/pca9685_ros2_control_example/config/mixed_controller.yaml    
      - ./pca9685_ros2_control/description.urdf.xacro:/colcon_ws/src/pca9685_ros2_control/pca9685_ros2_control_example/description/description.urdf.xacro
    restart: always
    network_mode: "host"
    command: ros2 launch pca9685_ros2_control_example mixed_example.launch.py

  ros-joy-linux:
    image: ghcr.io/rosblox/ros-joy-linux:humble
    volumes:
      - /dev/input:/dev/input
    privileged: true
    restart: always
    network_mode: "host"
    command: ros2 run joy_linux joy_linux_node

  rtklib:
    image: ghcr.io/rosblox/rtklib:latest
    restart: always
    command: str2str -in ntrip://$NTRIP_USER:$NTRIP_PASSWORD@www.swipos.ch:2101/MSM_GISGEO_LV95LHN95 -b 1 -out tcpcli://192.168.60.1:6666

  ros-septentrio-gnss-driver:
    image: ghcr.io/rosblox/ros-septentrio-gnss-driver:humble
    volumes:
      - ./septentrio_gnss_driver/rover_node.yaml:/opt/ros/humble/share/septentrio_gnss_driver/config/rover_node.yaml
    restart: always
    network_mode: "host"
    command: ros2 launch septentrio_gnss_driver rover_node.py

  ros-winch-control:
    image: ghcr.io/rosblox/ros-winch-control:humble
    volumes:
      - /home/rock/.ros:/tmp
    restart: always
    network_mode: "host"
    command: ros2 launch winch_control noodle.launch.py tendon1_file_path:=/tmp/tendon1_length.yaml tendon2_file_path:=/tmp/tendon2_length.yaml

  ros-imu-tools:
    image: ghcr.io/rosblox/ros-imu-tools:humble
    volumes:
      - ./imu_filter_madgwick/imu_filter.launch.py:/opt/ros/humble/share/imu_filter_madgwick/launch/imu_filter.launch.py
      - ./imu_filter_madgwick/imu_filter.yaml:/opt/ros/humble/share/imu_filter_madgwick/config/imu_filter.yaml
    network_mode: "host"
    restart: always
    command: ros2 launch imu_filter_madgwick imu_filter.launch.py

  ros-lsm6dsox-lis3mdl:
    image: ghcr.io/rosblox/ros-lsm6dsox-lis3mdl:humble
    devices:
      - "/dev/i2c-3:/dev/i2c-1"
    restart: always
    command: ros2 run ros_lsm6dsox_lis3mdl ros_lsm6dsox_lis3mdl_publisher

  ros-as5048b_1:
    image: ghcr.io/rosblox/ros-as5048b:humble
    restart: always
    devices:
      - /dev/i2c-1:/dev/i2c-1
    network_mode: "host"
    command: ros2 run ros_as5048b ros_as5048b_publisher --ros-args -p i2c_device:=1 -p i2c_address:=0x42

  ros-as5048b_2:
    image: ghcr.io/rosblox/ros-as5048b:humble
    restart: always
    devices:
      - /dev/i2c-1:/dev/i2c-1
    network_mode: "host"
    command: ros2 run ros_as5048b ros_as5048b_publisher --ros-args -p i2c_device:=1 -p i2c_address:=0x44
